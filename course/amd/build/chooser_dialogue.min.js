define ("core_course/chooser_dialogue",["exports","jquery","core/modal_events","core_course/local/chooser/selectors","core/modal_factory","core/templates","core/str","core/key_codes"],function(a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.displayChooser=void 0;b=j(b);c=i(c);d=j(d);e=i(e);f=i(f);function i(a){if(a&&a.__esModule){return a}else{var b={};if(null!=a){for(var c in a){if(Object.prototype.hasOwnProperty.call(a,c)){var d=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(a,c):{};if(d.get||d.set){Object.defineProperty(b,c,d)}else{b[c]=a[c]}}}}b.default=a;return b}}function j(a){return a&&a.__esModule?a:{default:a}}function k(a,b){return n(a)||m(a,b)||l()}function l(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function m(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=!0){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=!0;f=a}finally{try{if(!d&&null!=g["return"])g["return"]()}finally{if(e)throw f}}return c}function n(a){if(Array.isArray(a))return a}function o(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function p(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var h=a.apply(b,c);function f(a){o(h,d,e,f,g,"next",a)}function g(a){o(h,d,e,f,g,"throw",a)}f(void 0)})}}var q=function(){var a=p(regeneratorRuntime.mark(function a(b,c,e,g){var h,i,j,k,l,m,n;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:h=b.target.closest(d.default.regions.chooserOption.container);i=h.dataset.modname;a.next=4;return f.renderForPromise("core_course/chooser_help",c.get(i));case 4:j=a.sent;k=j.html;l=j.js;m=e.getBody()[0].querySelector(d.default.regions.help);a.next=10;return f.replaceNodeContents(m,k,l);case 10:g.carousel("next");g.carousel("pause");n=m.querySelector(d.default.regions.chooserSummary.content);n.focus();case 14:case"end":return a.stop();}}},a)}));return function(){return a.apply(this,arguments)}}(),r=function(a,c){a.getBody()[0].addEventListener("click",function(){var e=p(regeneratorRuntime.mark(function f(g){var e;return regeneratorRuntime.wrap(function(f){while(1){switch(f.prev=f.next){case 0:e=(0,b.default)(d.default.regions.carousel);e.carousel();e.carousel("pause");if(!g.target.closest(d.default.actions.optionActions.showSummary)){f.next=6;break}f.next=6;return q(g,c,a,e);case 6:if(g.target.matches(d.default.actions.closeOption)){e.carousel("prev");e.carousel("dispose")}case 7:case"end":return f.stop();}}},f)}));return function(){return e.apply(this,arguments)}}());s(a,c)},s=function(a,c){var e=document.querySelectorAll(d.default.regions.chooserOption.container);Array.from(e).forEach(function(e){return e.addEventListener("keyup",function(){var e=p(regeneratorRuntime.mark(function f(g){var e,i,j,k,l,m,n,o,p;return regeneratorRuntime.wrap(function(f){while(1){switch(f.prev=f.next){case 0:if(!(g.keyCode===h.arrowRight||g.keyCode===h.arrowLeft)){f.next=7;break}if(!g.target.matches(d.default.actions.optionActions.showSummary)){f.next=7;break}e=(0,b.default)(d.default.regions.carousel);e.carousel();e.carousel("pause");f.next=7;return q(g,c,a,e);case 7:if(g.keyCode===h.arrowRight){if(!g.target.matches(d.default.actions.optionActions.showSummary)){i=g.target.closest(d.default.regions.chooserOption.container);j=i.nextElementSibling;t(j)}}if(g.keyCode===h.arrowLeft){if(!g.target.matches(d.default.actions.optionActions.showSummary)){k=g.target.closest(d.default.regions.chooserOption.container);l=k.previousElementSibling;t(l)}}if(g.keyCode===h.home){m=document.querySelector(d.default.regions.chooserOptions);n=m.firstElementChild;n.focus()}if(g.keyCode===h.end){o=document.querySelector(d.default.regions.chooserOptions);p=o.lastElementChild;p.focus()}case 11:case"end":return f.stop();}}},f)}));return function(){return e.apply(this,arguments)}}())})},t=function(a){if(null!==a){a.focus()}},u=function(){var a=p(regeneratorRuntime.mark(function a(b){var d,h,i,j,l;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:d=document.querySelector(".section-modchooser-text[data-sectionid=\"0\"]");a.t0=Promise;a.t1=e;a.t2=e.types.DEFAULT;a.next=6;return(0,g.get_string)("addresourceoractivity");case 6:a.t3=a.sent;a.t4=f.render("core_course/chooser",b);a.t5={type:a.t2,title:a.t3,body:a.t4,large:!0};a.t6=a.t1.create.call(a.t1,a.t5);a.t7=[a.t6];a.next=13;return a.t0.all.call(a.t0,a.t7);case 13:h=a.sent;i=k(h,1);j=i[0];l=new Map;b.allmodules.forEach(function(a){l.set(a.modulename,a)});j.getRoot().on(c.bodyRendered,function(a){var b=document.querySelector("[data-region=\"".concat(a.target.dataset.region,"\"]"));b.classList.add("modchooser");r(j,l)});j.getRoot().on(c.hidden,function(){j.destroy();try{d.closest(".section-modchooser-link").focus()}catch(a){}});window.console.log("modal creation code",j);j.attachToDOM();return a.abrupt("return",j);case 23:case"end":return a.stop();}}},a)}));return function(){return a.apply(this,arguments)}}();a.displayChooser=u});
//# sourceMappingURL=chooser_dialogue.min.js.map
