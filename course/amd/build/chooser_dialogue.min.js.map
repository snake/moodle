{"version":3,"sources":["../src/chooser_dialogue.js"],"names":["define","$","ModalFactory","ModalEvents","Templates","CustomEvents","SELECTORS","CHOOSER_CONTAINER","CHOOSER_OPTIONS_CONTAINER","CHOOSER_OPTION_CONTAINER","CHOOSER_OPTION_ACTIONS_CONTAINER","CHOOSER_OPTION_INFO_CONTAINER","CHOOSER_OPTION_SUMMARY_CONTAINER","CHOOSER_OPTION_SUMMARY_CONTENT_CONTAINER","CHOOSER_OPTION_SUMMARY_ACTIONS_CONTAINER","CHOOSER_OPTION_ACTIONS","SHOW_CHOOSER_OPTION_SUMMARY","ADD_CHOOSER_OPTION","CLOSE_CHOOSER_OPTION_SUMMARY","registerListenerEvents","showChooserOptionSummary","events","activate","on","e","optionSummaryElement","target","closest","find","showOptionSummary","closeChooserOptionSummary","removeClass","topPosition","scrollTop","height","outerHeight","addClass","setOptionSummaryPositionAndHeight","optionSummaryContentElement","positionTop","optionSumaryActionsElement","contentHeight","css","displayChooser","data","render","then","html","create","type","types","DEFAULT","body","title","large","modal","getRoot","shown","show"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A type of dialogue used as for choosing options.\n *\n * @module     core_course/chooser_dialogue\n * @package    core\n * @copyright  2019 Mihail Geshoski <mihail@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.8\n */\n\ndefine(\n    [\n        'jquery',\n        'core/modal_factory',\n        'core/modal_events',\n        'core/templates',\n        'core/custom_interaction_events',\n    ],\n    function(\n        $,\n        ModalFactory,\n        ModalEvents,\n        Templates,\n        CustomEvents\n    ) {\n\n    /**\n     * Class names for different elements.\n     *\n     * @private\n     * @type {Object}\n     */\n    var SELECTORS = {\n        CHOOSER_CONTAINER: '[data-region=\"chooser-container\"]',\n        CHOOSER_OPTIONS_CONTAINER: '[data-region=\"chooser-options-container\"]',\n        CHOOSER_OPTION_CONTAINER: '[data-region=\"chooser-option-container\"]',\n        CHOOSER_OPTION_ACTIONS_CONTAINER: '[data-region=\"chooser-option-actions-container\"]',\n        CHOOSER_OPTION_INFO_CONTAINER: '[data-region=\"chooser-option-info-container\"]',\n        CHOOSER_OPTION_SUMMARY_CONTAINER: '[data-region=\"chooser-option-summary-container\"]',\n        CHOOSER_OPTION_SUMMARY_CONTENT_CONTAINER: '[data-region=\"chooser-option-summary-content-container\"]',\n        CHOOSER_OPTION_SUMMARY_ACTIONS_CONTAINER: '[data-region=\"chooser-option-summary-actions-container\"]',\n        CHOOSER_OPTION_ACTIONS: {\n            SHOW_CHOOSER_OPTION_SUMMARY: '[data-action=\"show-option-summary\"]',\n        },\n        ADD_CHOOSER_OPTION: '[data-action=\"add-chooser-option\"]',\n        CLOSE_CHOOSER_OPTION_SUMMARY: '[data-action=\"close-chooser-option-summary\"]',\n    };\n\n    /**\n     * Register chooser related event listeners.\n     *\n     * @method registerListenerEvents\n     */\n    var registerListenerEvents = function() {\n\n        var showChooserOptionSummary = $(SELECTORS.CHOOSER_OPTION_ACTIONS.SHOW_CHOOSER_OPTION_SUMMARY);\n\n        CustomEvents.define(showChooserOptionSummary, [\n            CustomEvents.events.activate\n        ]);\n\n        // Show the chooser option summary.\n        showChooserOptionSummary.on(CustomEvents.events.activate, function(e) {\n            var optionSummaryElement = $(e.target).closest(SELECTORS.CHOOSER_OPTION_CONTAINER)\n                .find(SELECTORS.CHOOSER_OPTION_SUMMARY_CONTAINER);\n            showOptionSummary(optionSummaryElement);\n        });\n\n        var closeChooserOptionSummary = $(SELECTORS.CLOSE_CHOOSER_OPTION_SUMMARY);\n\n        CustomEvents.define(closeChooserOptionSummary, [\n            CustomEvents.events.activate\n        ]);\n\n        // Close the chooser option summary.\n        closeChooserOptionSummary.on(CustomEvents.events.activate, function(e) {\n            var optionSummaryElement = $(e.target).closest(SELECTORS.CHOOSER_OPTION_SUMMARY_CONTAINER);\n            optionSummaryElement.removeClass('open');\n            $(SELECTORS.CHOOSER_CONTAINER).removeClass('noscroll');\n        });\n    };\n\n    /**\n      * Show the option summary for a particular chooser option.\n      *\n      * @method showOptionSummary\n      * @param {jQuery} optionSummaryElement The option summary container element\n      */\n    var showOptionSummary = function(optionSummaryElement) {\n        // Get the current scroll position of the chooser container element.\n        var topPosition = $(SELECTORS.CHOOSER_CONTAINER).scrollTop();\n        // Get the height of the chooser container element.\n        var height = $(SELECTORS.CHOOSER_CONTAINER).outerHeight();\n        // Disable the scroll of the chooser container element.\n        $(SELECTORS.CHOOSER_CONTAINER).addClass('noscroll');\n\n        setOptionSummaryPositionAndHeight(optionSummaryElement, topPosition, height);\n\n        var optionSummaryContentElement = optionSummaryElement.find(SELECTORS.CHOOSER_OPTION_SUMMARY_CONTENT_CONTAINER);\n        // Set the scroll of the type summary content element to top.\n        if (optionSummaryContentElement.scrollTop() > 0) {\n            optionSummaryContentElement.scrollTop(0);\n        }\n        // Show the particular summary overlay.\n        optionSummaryElement.addClass('open');\n    };\n\n    /**\n      * Set the top position and height of the option summary container.\n      * This is used to align the top position and height of the option summary container\n      * with the chooser options container.\n      *\n      * @method setOptionSummaryPositionAndHeight\n      * @param {jQuery} optionSummaryElement The option summary container element\n      * @param {int} positionTop The top position attributed to the option summary container element\n      * @param {int} height The height attributed to the option summary container element\n      */\n    var setOptionSummaryPositionAndHeight = function(optionSummaryElement, positionTop, height) {\n        var optionSummaryContentElement = optionSummaryElement.find(SELECTORS.CHOOSER_OPTION_SUMMARY_CONTENT_CONTAINER);\n        var optionSumaryActionsElement = optionSummaryElement.find(SELECTORS.CHOOSER_OPTION_SUMMARY_ACTIONS_CONTAINER);\n        var contentHeight = height - optionSumaryActionsElement.outerHeight();\n        optionSummaryContentElement.css({'height': contentHeight + 'px'});\n\n        optionSummaryElement.css({'top': positionTop + 'px', 'height': height + 'px'});\n    };\n\n    /**\n      * Display the module chooser.\n      *\n      * @method displayChooser\n      * @param {EventFacade} e Triggering Event\n      * @param {Object} data Object containing the data required by the chooser template\n      * @returns {Promise}\n      */\n    var displayChooser = function(e, data) {\n        return Templates.render('core_course/chooser', data)\n            .then(function(html) {\n                return ModalFactory.create({\n                    type: ModalFactory.types.DEFAULT,\n                    body: html,\n                    title: data.title,\n                    large: true\n                }).then(function(modal) {\n                    modal.getRoot().on(ModalEvents.shown, function(e) {\n                        $(e.target).addClass('modchooser');\n                        // Register event listeners.\n                        registerListenerEvents();\n                    });\n\n                    modal.show();\n\n                    return modal;\n                });\n            });\n    };\n\n    return /** @alias module:core/chooser_dialogue */{\n        displayChooser: displayChooser\n    };\n});\n"],"file":"chooser_dialogue.min.js"}