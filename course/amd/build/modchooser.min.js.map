{"version":3,"sources":["../src/modchooser.js"],"names":["define","Y","$","ChooserDialogue","CustomEvents","CSS","PAGECONTENT","SECTION","SECTIONMODCHOOSER","SITEMENU","SITETOPIC","displayModChooser","e","data","sectionid","currentTarget","parents","length","section","attr","replace","options","forEach","option","urls","addoption","displayChooser","_setupForSection","chooserspan","find","modchooserlink","children","wrapAll","events","activate","on","preventDefault","setupForSection","baseselector","each","init","initializer","use","sectionclass","M","course","format","get_sectionwrapperclass"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A type of dialogue used as for choosing modules in a course.\n *\n * @module     core_course/modchooser\n * @package    core_course\n * @copyright  2019 Mihail Geshoski <mihail@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.8\n */\ndefine(\n    [\n        'core/yui',\n        'jquery',\n        'core_course/chooser_dialogue',\n        'core/custom_interaction_events',\n    ],\n    function(\n        Y,\n        $,\n        ChooserDialogue,\n        CustomEvents\n    ) {\n\n    /**\n     * Class names for different elements.\n     *\n     * @private\n     * @type {Object}\n     */\n    var CSS = {\n        PAGECONTENT: 'body',\n        SECTION: null,\n        SECTIONMODCHOOSER: 'span.section-modchooser-link',\n        SITEMENU: '.block_site_main_menu',\n        SITETOPIC: 'div.sitetopic'\n    };\n\n    /**\n     * Display the module chooser.\n     *\n     * @method displayModChooser\n     * @param {EventFacade} e Triggering Event\n     * @param {Object} data Object containing the data required by the chooser template\n     */\n    var displayModChooser = function(e, data) {\n        var sectionid;\n        // Set the section for this version of the dialogue.\n        if ($(e.currentTarget).parents(CSS.SITETOPIC).length) {\n            // The site topic has a sectionid of 1.\n            sectionid = 1;\n        } else if ($(e.currentTarget).parents(CSS.SECTION).length) {\n            var section = $(e.currentTarget).parents(CSS.SECTION);\n            sectionid = section.attr('id').replace('section-', '');\n        } else if ($(e.currentTarget).parents(CSS.SITEMENU).length) {\n            // The block site menu has a sectionid of 0.\n            sectionid = 0;\n        }\n        // If the sectionid exists, append the section parameter to the add module url.\n        if (sectionid !== undefined) {\n            data.options.forEach(function(option) {\n                option.urls.addoption += '&section=' + sectionid;\n            });\n        }\n\n        ChooserDialogue.displayChooser(e, data);\n    };\n\n    /**\n     * Update any section areas within the scope of the specified\n     * selector with AJAX equivalents.\n     *\n     * @method _setupForSection\n     * @private\n     * @param {jQuery} section The selector to limit scope to\n     * @param {Object} data Object containing the data required by the chooser template\n     * @return void\n     */\n    var _setupForSection = function(section, data) {\n        var chooserspan = $(section).find(CSS.SECTIONMODCHOOSER);\n        if (!chooserspan.length) {\n            return;\n        }\n        var modchooserlink = $(chooserspan).children().wrapAll(\"<a href='#' class='chooser-link' />\");\n\n        CustomEvents.define(modchooserlink, [\n            CustomEvents.events.activate\n        ]);\n\n        // Display module chooser event listener.\n        modchooserlink.on(CustomEvents.events.activate, function(e) {\n            e.preventDefault();\n            displayModChooser(e, data);\n        });\n    };\n\n    /**\n     * Update any section areas within the scope of the specified\n     * selector with AJAX equivalents.\n     *\n     * @method setupForSection\n     * @param {Object} data Object containing the data required by the chooser template\n     * @param {String} baseselector The selector to limit scope to\n     */\n    var setupForSection = function(data, baseselector) {\n        if (!baseselector) {\n            baseselector = CSS.PAGECONTENT;\n        }\n        // Setup for site topics.\n        $(baseselector).find(CSS.SITETOPIC).each(function() {\n            _setupForSection(this, data);\n        });\n        // Setup for standard course topics.\n        if (CSS.SECTION) {\n            $(baseselector).find(CSS.SECTION).each(function() {\n                _setupForSection(this, data);\n            });\n        }\n\n        // Setup for the block site menu.\n        $(baseselector).find(CSS.SITEMENU).each(function() {\n            _setupForSection(this, data);\n        });\n    };\n\n    /**\n     * Set up the activity chooser.\n     *\n     * @method initializer\n     * @param {Object} data Object containing the data required by the chooser template\n     */\n    var initializer = function(data) {\n        Y.use('moodle-course-coursebase', function() {\n            var sectionclass = M.course.format.get_sectionwrapperclass();\n            if (sectionclass) {\n                CSS.SECTION = '.' + sectionclass;\n            }\n            // Initialize existing sections and register for dynamically created sections.\n            setupForSection(data);\n        });\n    };\n\n    return /** @alias module:core_course/modchooser */{\n        init: initializer\n    };\n});\n"],"file":"modchooser.min.js"}