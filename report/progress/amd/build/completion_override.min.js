define(["jquery","core/ajax","core/str","core/notification"],function(a,b,c,d){return{update:function(){a("#completion-progress a.changecompl").on("click",function(e){e.preventDefault();var f=a(this),g=f.data("changecompl"),h=g.split("-"),i=h[0],j=h[1],k=h[2],l=1==k?"completion-y":"completion-n";c.get_strings([{key:l,component:"completion"}]).done(function(e){c.get_strings([{key:"confirm",component:"moodle"},{key:"areyousureoverridecompletion",component:"completion",param:e[0]},{key:"yes",component:"moodle"},{key:"cancel",component:"moodle"}]).done(function(c){d.confirm(c[0],c[1],c[2],c[3],function(){f.append('<div class="ajaxworking" />');var c=b.call([{methodname:"core_completion_override_activity_completion_status",args:{userid:i,cmid:j,newstate:k}}]);c[0].then(function(b){f.data("changecompl",b.changecompl),f.attr("data-changecompl",b.changecompl),f.children("img").replaceWith(b.img),a(".ajaxworking").remove()}).fail(d.exception)})}).fail(d.exception)}).fail(d.exception)})}}});