define("mod_lti/activitycontentitem",["exports","core_ltix/contentitem","mod_lti/form-field","core/templates"],(function(_exports,_contentitem,_formField,_templates){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Class that defines content item selection process for creating an LTI external tool activity.
   *
   * @module     mod_lti/activitycontentitem
   * @copyright  2024 Mihail Geshoski <mihail@moodle.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_contentitem=_interopRequireDefault(_contentitem),_formField=_interopRequireDefault(_formField),_templates=_interopRequireDefault(_templates);const Selectors_selectContentButton='[name="selectcontent"]',Selectors_activityNameInput="#id_name",Selectors_activityDescriptionTextarea="#id_introeditor",Selectors_submitAndLaunchButton="#id_submitbutton",Selectors_submitAndCourseButton="#id_submitbutton2",Selectors_activityForm="#region-main-box form",Selectors_cancelButton="#id_cancel",Selectors_selectContentIndicator="#id_selectcontentindicator",Selectors_allowGradesCheckbox="#id_instructorchoiceacceptgrades",Selectors_gradeTypeSelect="#id_grade_modgrade_type",Selectors_buttonGroup="#fgroup_id_buttonar";class ActivityContentItem extends _contentitem.default{constructor(toolID,contextID){super(toolID,contextID,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}getContentItemTriggerSelector(){return Selectors_selectContentButton}customContentItemTriggerActions(){this.toolInstanceTitle=document.querySelector(Selectors_activityNameInput).value.trim(),this.toolInstanceText=document.querySelector(Selectors_activityDescriptionTextarea).value.trim()}processContentItemReturnData(returnData){if(returnData.multiple){this.getLtiFormFields().forEach((field=>{const value="name"===field.name?"item":null;field.setFieldValue(value)}));const variants=returnData.multiple.map((item=>this.configToVariant(item)));this.showMultipleSummaryAndHideForm(returnData.multiple);const submitAndCourseButton=document.querySelector(Selectors_submitAndCourseButton);submitAndCourseButton.onclick=e=>{e.preventDefault(),submitAndCourseButton.disabled=!0;const form=document.querySelector(Selectors_activityForm),formData=new FormData(form),navigateBackToCourse=()=>document.querySelector(Selectors_cancelButton).click();variants.reduce(((promise,variant)=>{Object.entries(variant).forEach((_ref=>{let[key,value]=_ref;return formData.set(key,value)}));const requestBody=new URLSearchParams(formData),doPost=()=>fetch(document.location.pathname,{method:"POST",body:requestBody});return promise.then(doPost).catch(doPost)}),Promise.resolve()).then(navigateBackToCourse).catch(navigateBackToCourse)}}else{this.getLtiFormFields().forEach((field=>{var _returnData$field$nam;const value=null!==(_returnData$field$nam=returnData[field.name])&&void 0!==_returnData$field$nam?_returnData$field$nam:null;field.setFieldValue(value)}));document.querySelector(Selectors_selectContentIndicator).innerHTML=returnData.selectcontentindicator;const allowGradesCheckbox=document.querySelector(Selectors_allowGradesCheckbox);if(allowGradesCheckbox.dispatchEvent(new Event("change")),allowGradesCheckbox.checked){const gradeTypeSelect=document.querySelector(Selectors_gradeTypeSelect);gradeTypeSelect.value="point",gradeTypeSelect.dispatchEvent(new Event("change"))}}}toggleElementVisibility(element,isVisible){element.toggleAttribute("hidden",!isVisible),element.setAttribute("aria-hidden",isVisible?"false":"true"),element.setAttribute("tab-index",isVisible?"1":"-1")}async showMultipleSummaryAndHideForm(items){const form=document.querySelector(Selectors_activityForm),toolArea=form.querySelector('[data-attribute="dynamic-import"]'),buttonGroup=form.querySelector(Selectors_buttonGroup),submitAndLaunchButton=form.querySelector(Selectors_submitAndLaunchButton);[...form.children].forEach((child=>{this.toggleElementVisibility(child,!1)})),this.toggleElementVisibility(submitAndLaunchButton,!1);const{html:html,js:js}=await _templates.default.renderForPromise("mod_lti/tool_deeplinking_results",{items:items});await _templates.default.replaceNodeContents(toolArea,html,js),this.toggleElementVisibility(toolArea,!0),this.toggleElementVisibility(buttonGroup,!0)}configToVariant(config){const variant={};return["name","toolurl","securetoolurl","instructorcustomparameters","icon","secureicon","launchcontainer","lineitemresourceid","lineitemtag","lineitemsubreviewurl","lineitemsubreviewparams"].forEach((field=>{variant[field]=config[field]||""})),variant["introeditor[text]"]=config.introeditor?config.introeditor.text:"",variant["introeditor[format]"]=config.introeditor?config.introeditor.format:"",1===config.instructorchoiceacceptgrades?(variant.instructorchoiceacceptgrades="1",variant["grade[modgrade_point]"]=config.grade_modgrade_point||"100"):variant.instructorchoiceacceptgrades="0",variant}getLtiFormFields(){return[new _formField.default("name",_formField.default.TYPES.TEXT,!1,""),new _formField.default("introeditor",_formField.default.TYPES.EDITOR,!1,""),new _formField.default("toolurl",_formField.default.TYPES.TEXT,!0,""),new _formField.default("securetoolurl",_formField.default.TYPES.TEXT,!0,""),new _formField.default("instructorchoiceacceptgrades",_formField.default.TYPES.CHECKBOX,!0,!0),new _formField.default("instructorchoicesendname",_formField.default.TYPES.CHECKBOX,!0,!0),new _formField.default("instructorchoicesendemailaddr",_formField.default.TYPES.CHECKBOX,!0,!0),new _formField.default("instructorcustomparameters",_formField.default.TYPES.TEXT,!0,""),new _formField.default("icon",_formField.default.TYPES.TEXT,!0,""),new _formField.default("secureicon",_formField.default.TYPES.TEXT,!0,""),new _formField.default("launchcontainer",_formField.default.TYPES.SELECT,!0,0),new _formField.default("grade_modgrade_point",_formField.default.TYPES.TEXT,!1,""),new _formField.default("lineitemresourceid",_formField.default.TYPES.TEXT,!0,""),new _formField.default("lineitemtag",_formField.default.TYPES.TEXT,!0,""),new _formField.default("lineitemsubreviewurl",_formField.default.TYPES.TEXT,!0,""),new _formField.default("lineitemsubreviewparams",_formField.default.TYPES.TEXT,!0,"")]}}return _exports.default=ActivityContentItem,_exports.default}));

//# sourceMappingURL=activitycontentitem.min.js.map