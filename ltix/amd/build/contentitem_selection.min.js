define("core_ltix/contentitem_selection",["exports","core/notification","core/str","core/templates","core/modal","core/modal_events","core/url"],(function(_exports,_notification,_str,_templates,_modal,_modal_events,_url){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_notification=_interopRequireDefault(_notification),_templates=_interopRequireDefault(_templates),_modal=_interopRequireDefault(_modal),_modal_events=_interopRequireDefault(_modal_events),_url=_interopRequireDefault(_url);const Selectors_loadingContainer=".contentitem-loading-container",Selectors_failedContainer="#tool-loading-failed",Selectors_iframe="#contentitem-page-iframe",Selectors_requestForm="#contentitem-request-form",Selectors_mainContainer="div.contentitem-container";return _exports.default=class{static async init(toolID,contextID){new this(toolID,contextID,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null).registerEventListeners()}constructor(toolID,contextID){let defaultTitle=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,defaultText=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;_defineProperty(this,"toolID",null),_defineProperty(this,"contextID",null),_defineProperty(this,"defaultTitle",null),_defineProperty(this,"defaultText",null),_defineProperty(this,"modal",null),this.toolID=toolID,this.contextID=contextID,this.defaultTitle=defaultTitle,this.defaultText=defaultText}registerEventListeners(){document.addEventListener("click",(async e=>{e.target.closest(this.getContentItemTriggerSelector())&&(e.preventDefault(),globalThis.contentItem=this,this.customContentItemTriggerActions(),this.modal=await this.showModal(),this.submitForm())}))}async showModal(){const modal=await _modal.default.create({title:await(0,_str.getString)("selectcontent","lti"),body:await this.renderModalBody(),large:!0});return modal.getRoot().on(_modal_events.default.hidden,(()=>{modal.destroy(),_notification.default.fetchNotifications()})),modal.show(),modal}async renderModalBody(){var context={url:_url.default.relativeUrl("/ltix/contentitemselection.php"),postData:{toolid:this.toolID,contextid:this.contextID,defaulttitle:this.defaultTitle,defaulttext:this.defaultText}};return _templates.default.render("core_ltix/contentitem_selection",context)}submitForm(){const modalRoot=this.modal.getRoot()[0];setTimeout((()=>{modalRoot.querySelector(Selectors_failedContainer).classList.remove("hidden")}),2e4),modalRoot.querySelector(Selectors_requestForm).submit();const iframe=modalRoot.querySelector(Selectors_iframe);iframe.addEventListener("load",(()=>{modalRoot.querySelector(Selectors_loadingContainer).classList.add("hidden"),iframe.classList.remove("hidden");const containerWidth=modalRoot.querySelector(Selectors_mainContainer).offsetWidth;iframe.style.width="".concat(containerWidth,"px");const containerHeight=.75*containerWidth;modalRoot.querySelector(Selectors_iframe).style.height="".concat(containerHeight,"px")}))}contentItemReturnAction(returnData){this.modal&&this.modal.hide(),this.processContentItemReturnData(returnData)}customContentItemTriggerActions(){}getContentItemTriggerSelector(){throw new Error("getContentItemTriggerSelector() must be implemented in ".concat(this.constructor.name))}processContentItemReturnData(returnData){throw new Error("processContentItemReturnData(".concat(returnData,") must be implemented in ").concat(this.constructor.name))}},_exports.default}));

//# sourceMappingURL=contentitem_selection.min.js.map