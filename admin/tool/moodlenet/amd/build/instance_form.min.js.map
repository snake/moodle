{"version":3,"sources":["../src/instance_form.js"],"names":["define","Validator","Selectors","LoadingIcon","registerListenerEvents","page","defaulturl","addEventListener","e","target","matches","action","browse","window","location","submit","input","querySelector","overlay","region","spinner","validationArea","document","classList","remove","addIconToContainerWithPromise","validation","then","result","resolve","add","innerText","message","setTimeout","domain","catch","init","instancePage"],"mappings":"AAyBAA,OAAM,gCAAC,CAAC,0BAAD,CAA6B,0BAA7B,CAAyD,kBAAzD,CAAD,CACF,SAASC,CAAT,CAAoBC,CAApB,CAA+BC,CAA/B,CAA4C,IAmBxCC,CAAAA,CAAsB,CAAG,SAAgCC,CAAhC,CAAsCC,CAAtC,CAAkD,CAC3ED,CAAI,CAACE,gBAAL,CAAsB,OAAtB,CAA+B,SAASC,CAAT,CAAY,CAEvC,GAAIA,CAAC,CAACC,MAAF,CAASC,OAAT,CAAiBR,CAAS,CAACS,MAAV,CAAiBC,MAAlC,CAAJ,CAA+C,CAC3CC,MAAM,CAACC,QAAP,CAAkBR,CACrB,CAGD,GAAIE,CAAC,CAACC,MAAF,CAASC,OAAT,CAAiBR,CAAS,CAACS,MAAV,CAAiBI,MAAlC,CAAJ,CAA+C,IACvCC,CAAAA,CAAK,CAAGX,CAAI,CAACY,aAAL,CAAmB,0BAAnB,CAD+B,CAEvCC,CAAO,CAAGb,CAAI,CAACY,aAAL,CAAmBf,CAAS,CAACiB,MAAV,CAAiBC,OAApC,CAF6B,CAGvCC,CAAc,CAAGC,QAAQ,CAACL,aAAT,CAAuBf,CAAS,CAACiB,MAAV,CAAiBE,cAAxC,CAHsB,CAK3CH,CAAO,CAACK,SAAR,CAAkBC,MAAlB,CAAyB,QAAzB,EACA,GAAIJ,CAAAA,CAAO,CAAGjB,CAAW,CAACsB,6BAAZ,CAA0CP,CAA1C,CAAd,CACAjB,CAAS,CAACyB,UAAV,CAAqBV,CAArB,EACKW,IADL,CACU,SAASC,CAAT,CAAiB,CACnBR,CAAO,CAACS,OAAR,GACAX,CAAO,CAACK,SAAR,CAAkBO,GAAlB,CAAsB,QAAtB,EACA,GAAIF,CAAM,CAACA,MAAX,CAAmB,CACfZ,CAAK,CAACO,SAAN,CAAgBC,MAAhB,CAAuB,YAAvB,EACAR,CAAK,CAACO,SAAN,CAAgBO,GAAhB,CAAoB,UAApB,EACAT,CAAc,CAACU,SAAf,CAA2BH,CAAM,CAACI,OAAlC,CACAX,CAAc,CAACE,SAAf,CAAyBC,MAAzB,CAAgC,YAAhC,EACAH,CAAc,CAACE,SAAf,CAAyBO,GAAzB,CAA6B,cAA7B,EAEAG,UAAU,CAAC,UAAW,CAClBpB,MAAM,CAACC,QAAP,CAAkBc,CAAM,CAACM,MAC5B,CAFS,CAEP,GAFO,CAGb,CAVD,IAUO,CACHlB,CAAK,CAACO,SAAN,CAAgBO,GAAhB,CAAoB,YAApB,EACAT,CAAc,CAACU,SAAf,CAA2BH,CAAM,CAACI,OAAlC,CACAX,CAAc,CAACE,SAAf,CAAyBO,GAAzB,CAA6B,YAA7B,CACH,CAER,CApBD,EAoBGK,KApBH,EAqBH,CACJ,CApCD,CAqCH,CAzD2C,CA2D5C,MAAO,CACHC,IAAI,CArDG,SAAc9B,CAAd,CAA0B,CACjC,GAAID,CAAAA,CAAI,CAAGiB,QAAQ,CAACL,aAAT,CAAuBf,CAAS,CAACiB,MAAV,CAAiBkB,YAAxC,CAAX,CACAjC,CAAsB,CAACC,CAAD,CAAOC,CAAP,CACzB,CAiDM,CAGV,CA/DK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Our basic form manager for when a user either enters\n * their profile url or just wants to browse.\n *\n * @module     tool_moodlenet/instance_form\n * @package    tool_moodlenet\n * @copyright  2020 Mathew May <mathew.solutions>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['tool_moodlenet/validator', 'tool_moodlenet/selectors', 'core/loadingicon'],\n    function(Validator, Selectors, LoadingIcon) {\n    /**\n     * Set up the form.\n     *\n     * @method init\n     * @param {String} defaulturl Our base case / Moodle's own MoodleNet instance.\n     */\n    var init = function init(defaulturl) {\n        var page = document.querySelector(Selectors.region.instancePage);\n        registerListenerEvents(page, defaulturl);\n    };\n\n    /**\n     * Add the event listeners to our form.\n     *\n     * @method registerListenerEvents\n     * @param {HTMLElement} page The whole page element for our form area\n     * @param {String} defaulturl Our base case / Moodle's own MoodleNet instance.\n     */\n    var registerListenerEvents = function registerListenerEvents(page, defaulturl) {\n        page.addEventListener('click', function(e) {\n            // Browse without an account.\n            if (e.target.matches(Selectors.action.browse)) {\n                window.location = defaulturl;\n            }\n\n            // Our fake submit button / browse button.\n            if (e.target.matches(Selectors.action.submit)) {\n                var input = page.querySelector('[data-var=\"mnet-link\"]');\n                var overlay = page.querySelector(Selectors.region.spinner);\n                var validationArea = document.querySelector(Selectors.region.validationArea);\n\n                overlay.classList.remove('d-none');\n                var spinner = LoadingIcon.addIconToContainerWithPromise(overlay);\n                Validator.validation(input)\n                    .then(function(result) {\n                        spinner.resolve();\n                        overlay.classList.add('d-none');\n                        if (result.result) {\n                            input.classList.remove('is-invalid'); // Just in case the class has been applied already.\n                            input.classList.add('is-valid');\n                            validationArea.innerText = result.message;\n                            validationArea.classList.remove('text-error');\n                            validationArea.classList.add('text-success');\n                            // Give the user some time to see their input is valid.\n                            setTimeout(function() {\n                                window.location = result.domain;\n                            }, 1000);\n                        } else {\n                            input.classList.add('is-invalid');\n                            validationArea.innerText = result.message;\n                            validationArea.classList.add('text-error');\n                        }\n                        return;\n                }).catch();\n            }\n        });\n    };\n\n    return {\n        init: init,\n    };\n});\n"],"file":"instance_form.min.js"}