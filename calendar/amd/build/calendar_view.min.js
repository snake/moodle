define(["jquery","core/str","core/notification","core_calendar/selectors","core_calendar/events","core_calendar/view_manager","core_calendar/repository","core/modal_factory","core_calendar/modal_event_form","core/modal_events","core_calendar/crud"],function(a,b,c,d,e,f,g,h,i,j,k){var l=function(b){var g=a("body"),h=a(d.deleteLink),i=a(d.newEventButton),j=b.data("courseid"),l=k.registerEventFormModal(b,i);k.registerRemove(h),b.on("click",d.deleteLink,function(c){c.preventDefault();var d=a(c.currentTarget),h=d.data("event-id"),i=d.data("title"),l=d.data("event-event-count");k.confirmDeletion(h,i,l).then(function(a){g.on(e.deleted,function(){a.hide(),f.reloadCurrentUpcoming(b,j)}.bind(this))})}),b.on("click",d.editLink,function(b){b.preventDefault();var d=a(b.currentTarget);l.then(function(a){var b=d.data("event-id");b&&a.setEventId(b),a.show()}).fail(c.exception)}),b.on("change",d.courseSelector,function(){var e=a(this),g=e.val();f.reloadCurrentUpcoming(b,g).then(function(){return b.find(d.courseSelector).val(g)}).fail(c.exception)}),g.on(e.filterChanged,function(a,c){var e=b.find(d.eventType[c.type]);1==c.hidden?e.addClass("hidden"):e.removeClass("hidden")})};return{init:function(b){b=a(b),f.init(b),l(b)}}});